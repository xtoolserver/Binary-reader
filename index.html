<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mr X Love Dept 💘</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    margin:0; padding:20px;
    background:#111;
    color:#eee;
    font-family:'Poppins', sans-serif;
    display:flex;
    flex-direction: column;
    align-items: center;
    min-height:100vh;
  }
  h1 {
    color:#ff4081;
    text-shadow: 0 0 8px #ff4081;
    margin-bottom: 10px;
  }
  .btn {
    background: linear-gradient(45deg, #ff4081, #7b2ff7);
    border:none;
    padding: 12px 30px;
    margin: 10px;
    border-radius: 25px;
    color: white;
    font-weight: 600;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    transition: transform 0.2s ease;
  }
  .btn:hover:not(:disabled) {
    transform: scale(1.05);
  }
  .hidden { display:none; }
  #welcomeScreen, #quizScreen, #resultScreen, #chatScreen {
    width: 100%;
    max-width: 400px;
    margin-top: 20px;
    text-align: center;
  }
  #questionText {
    font-size: 20px;
    margin-bottom: 20px;
  }
  .answerBtns {
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  #resultMessage {
    font-size: 22px;
    margin: 15px 0 25px 0;
    font-weight: 700;
    color: #00ff99;
    text-shadow: 0 0 8px #00ff99;
  }
  #adviceText {
    font-size: 18px;
    color: #ff77cc;
    margin-bottom: 25px;
  }
  /* Chat */
  #chatMessages {
    background: #222;
    height: 300px;
    overflow-y: auto;
    padding: 15px;
    border-radius: 15px;
    margin-bottom: 10px;
    text-align: left;
    font-size: 16px;
  }
  .chat-msg {
    margin-bottom: 10px;
    padding: 8px 15px;
    border-radius: 20px;
    max-width: 80%;
    word-wrap: break-word;
  }
  .chat-user {
    background: #ff4081;
    color: white;
    align-self: flex-end;
    margin-left: auto;
  }
  .chat-mrX {
    background: #7b2ff7;
    color: white;
  }
  #chatInput {
    width: 100%;
    padding: 10px 15px;
    border-radius: 25px;
    border: none;
    font-size: 16px;
    outline: none;
  }
  #sendBtn {
    margin-top: 10px;
    width: 100%;
  }
  footer {
    margin-top: auto;
    font-size: 12px;
    color: #666;
  }
</style>
</head>
<body>

<h1>💘 Mr X Love Dept 💘</h1>

<!-- Welcome Screen -->
<div id="welcomeScreen">
  <p style="font-size:18px;line-height:1.4;max-width:350px;margin:auto;">
    Karibu kwenye <strong>Mr X Love Dept</strong>!  
    Hapa tutagundua kama una crush, tukupa ushauri wa moyo,  
    na pia Mr X AI atakuwa tayari kujibu maswali yako kuhusu mapenzi!  
    💖🧠
  </p>
  <button id="startQuizBtn" class="btn">Anza Crush Quiz 😳</button>
</div>

<!-- Quiz Screen -->
<div id="quizScreen" class="hidden">
  <div id="questionText"></div>
  <div class="answerBtns">
    <button class="btn" id="yesBtn">Ndiyo</button>
    <button class="btn" id="noBtn">Hapana</button>
  </div>
</div>

<!-- Result Screen -->
<div id="resultScreen" class="hidden">
  <div id="resultMessage"></div>
  <div id="adviceText"></div>
  <button id="proceedChatBtn" class="btn">Nenda kwenye Chat na Mr X 🤖</button>
  <button id="retryQuizBtn" class="btn">Rudia Quiz 🔄</button>
</div>

<!-- Chat Screen -->
<div id="chatScreen" class="hidden" style="display:flex; flex-direction: column; max-width:400px; width: 100%;">
  <div id="chatMessages"></div>
  <input type="text" id="chatInput" placeholder="Uliza swali kuhusu mapenzi hapa..." autocomplete="off" />
  <button id="sendBtn" class="btn">Tuma</button>
</div>

<footer>© Mr X Love Dept 2025</footer>

<script>
  // OpenAI API key here - Replace with your own key
  const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

  // Screens references
  const welcomeScreen = document.getElementById('welcomeScreen');
  const quizScreen = document.getElementById('quizScreen');
  const resultScreen = document.getElementById('resultScreen');
  const chatScreen = document.getElementById('chatScreen');

  // Quiz refs
  const questionText = document.getElementById('questionText');
  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');

  // Result refs
  const resultMessage = document.getElementById('resultMessage');
  const adviceText = document.getElementById('adviceText');
  const proceedChatBtn = document.getElementById('proceedChatBtn');
  const retryQuizBtn = document.getElementById('retryQuizBtn');

  // Chat refs
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  // Quiz data
  const questions = [
    "Ukimuona mtu fulani moyo wako unadunda haraka kidogo?",
    "Unatabasamu bila kujua ukimsikia au kumwona?",
    "Ulishawahi kum-check Instagram bila sababu?",
    "Unajifanya busy lakini ndani unataka akutext tu?",
    "Ushawahi kuwaza mkioana au mkikaa pamoja?"
  ];
  let currentQuestion = 0;
  let score = 0;

  // Start quiz
  document.getElementById('startQuizBtn').onclick = () => {
    welcomeScreen.classList.add('hidden');
    quizScreen.classList.remove('hidden');
    currentQuestion = 0;
    score = 0;
    showQuestion();
  };

  function showQuestion() {
    questionText.textContent = questions[currentQuestion];
  }

  yesBtn.onclick = () => answer(true);
  noBtn.onclick = () => answer(false);

  function answer(isYes) {
    if (isYes) score++;
    currentQuestion++;
    if(currentQuestion < questions.length) {
      showQuestion();
    } else {
      showResult();
    }
  }

  function showResult() {
    quizScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');
    if(score >= 4) {
      resultMessage.textContent = "🔥 Hakika una CRUSH mzito! 💘😳";
      adviceText.textContent = "Mr X 🧠: Bro/Sis... acha kunyamaza, tuma DM ya kiungwana. Hii ni dalili ya moyo kukaliwa mzito. Sema tu 'Hi 😊' leo, usisubiri hadi Valentine 😆";
    } else if(score >= 2) {
      resultMessage.textContent = "😏 Kuna mtu anakutesa moyo kimya kimya!";
      adviceText.textContent = "Mr X 🧠: Kuna feelings zinakuumiza polepole. Chunguza vizuri – je, ni mapenzi au ni hisia tu? Tafuta clues, usikurupuke, lakini usikose nafasi pia!";
    } else {
      resultMessage.textContent = "🧊 Hakuna crush... moyo wako uko cold kama barafu!";
      adviceText.textContent = "Mr X 🧠: Wewe ni ice block 🧊😂 – lakini hakuna noma. Moyo ukitaka kumpenda mtu utajijua. Kwa sasa endelea kufurahia maisha!";
    }
  }

  // Buttons on result screen
  proceedChatBtn.onclick = () => {
    resultScreen.classList.add('hidden');
    chatScreen.classList.remove('hidden');
    addMrXMessage("Habari! Niambie swali lolote kuhusu mapenzi, na Mr X atakujibu.");
  };

  retryQuizBtn.onclick = () => {
    resultScreen.classList.add('hidden');
    welcomeScreen.classList.remove('hidden');
  };

  // Chat system
  function addUserMessage(msg) {
    const div = document.createElement('div');
    div.className = 'chat-msg chat-user';
    div.textContent = msg;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function addMrXMessage(msg) {
    const div = document.createElement('div');
    div.className = 'chat-msg chat-mrX';
    div.textContent = msg;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  sendBtn.onclick = async () => {
    const question = chatInput.value.trim();
    if(!question) return;
    addUserMessage(question);
    chatInput.value = '';
    addMrXMessage("Natazama moyo wa Mr X... 🧠");

    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions',{
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':`Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model:"gpt-4o-mini",
          messages:[
            {role:"system", content:"Wewe ni Mr X, mtaalamu wa mapenzi na mshauri wa hisia za moyo kwa lugha ya Kiswahili. Jibu maswali kwa ushauri mzito, ukitumia tone rafiki na mchokozi kidogo."},
            {role:"user", content: question}
          ],
          max_tokens: 400,
          temperature: 0.8
        })
      });
      const data = await response.json();
      if(data.choices && data.choices.length > 0) {
        addMrXMessage(data.choices[0].message.content.trim());
      } else {
        addMrXMessage("Samahani, nilikumbwa na shida kupata jibu. Jaribu tena.");
      }
    } catch (err) {
      addMrXMessage("Kuna tatizo la mtandao au API key si sahihi. Tafadhali hakiki na jaribu tena.");
    }
  };

  // Optional: Enter key to send
  chatInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      sendBtn.click();
    }
  });
</script>

</body>
    </html>
